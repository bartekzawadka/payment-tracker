trigger: none
name: 'Publish docker images'

resources:
  pipelines:
  - pipeline: build
    source: Build
    trigger: true

variables:
  - imageName: '$(imageName)'

jobs:
    - job: DockerPublishj
      displayName: 'Publish docker images'
      variables:
        BuildConfiguration: Release
      workspace: 
        clean: all
      pool:
        name: Azure Pipelines
        vmImage: ubuntu-20.04
      steps:
          - task: Docker@2
            displayName: Build API image
            inputs:
              repository: $(imageName)
              command: build
              Dockerfile: $(Build.SourcesDirectory)/src/api/Payment.Tracker/Payment.Tracker.Api/Dockerfile

          - task: Docker@2
            displayName: Publish API image
            inputs:
              containerRegistry: 'dockerhub-payment-tracker-api'
              repository: $(imageName)
              command: push
        # - task: DownloadPipelineArtifact@2
        #   displayName: 'Download artifacts'
        #   inputs:
        #     source: specific
        #     project: 'Payment Tracker'
        #     pipeline: build
        # - task: ExtractFiles@1
        #   displayName: 'Extract artifacts'
        #   inputs:
        #     archiveFilePatterns: '$(System.ArtifactsDirectory)/**/*.zip'
